#!/usr/bin/env node

import { resolve } from 'path'
import getConfig from '../config'
import parseArgs from 'minimist'
import buildApp from 'next/dist/server/build'
import exportApp from 'next/dist/server/export'

const argv = parseArgs(process.argv.slice(2))
const dir = resolve(argv._[0] || '.')
const config = getConfig(dir)

buildApp(dir, config)
.then(() => config.static
  ? exportApp(dir, {outdir: resolve(dir, 'out')})
  : Promise.resolve()
)
.catch(err => {
  console.error(err)
  process.exit(1)
})
